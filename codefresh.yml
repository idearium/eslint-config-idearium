version: '1.0'

steps:

  BuildingDockerImage:
    build_arguments:
      - CF_BRANCH=${{CF_BRANCH}}
      - CF_PULL_REQUEST_ACTION=${{CF_PULL_REQUEST_ACTION}}
      - CF_PULL_REQUEST_TARGET=${{CF_PULL_REQUEST_TARGET}}
      - CF_REPO_NAME=${{CF_REPO_NAME}}
      - CODEFRESH=true
    dockerfile: Dockerfile
    image_name: idearium/eslint-config-idearium
    title: Building Docker image
    type: build
    working_directory: ./

  RunningDeployScript:
    title: Running deploy script
    image: '${{BuildingDockerImage}}'
    working_directory: IMAGE_WORK_DIR
    entry_point:
      - /bin/sh
    commands:
      - echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" > ./.npmrc
      - npm publish
    when:
      branch:
        only:
          - /^v([0-9]\.){2}[0-9](-(alpha|beta)\.[0-9]{1,3})?$/i
